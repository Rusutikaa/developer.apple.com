<!DOCTYPE html><html lang="en" data-reactroot=""><head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8"><title>Performing Manual Server Trust Authentication | Apple Developer Documentation</title><!-- link href="https://www.apple.com/wss/fonts?families=SF+Pro,v1|SF+Mono,v1|SF+Pro+Icons,v1" media="all" rel="stylesheet" type="text/css"/ --><meta content="width=device-width, initial-scale=1 viewport-fit=cover" name="viewport"/><meta data-pid="492525"/><link href="../../../../documentation/assets/application-e5bb1544.css" media="all" rel="stylesheet" type="text/css"/><noscript><link href="../../../../documentation/assets/nojs-c6be9131.css" media="all" rel="stylesheet" type="text/css"/></noscript><link rel="mask-icon" href="../../../../documentation/assets/apple-logo.svg" color="#000"/><link rel="shortcut icon" href="../../../../documentation/assets/favicon.ico"/><script src="../../../../documentation/assets/shared-b7676010.js"></script></head><body><div id="app"><div><a href="#main" id="skip-localnav" class="showonfocus hidden">Skip Navigation</a><aside id="ac-gn-segmentbar" class="ac-gn-segmentbar" lang="en-US" dir="ltr"></aside><input type="checkbox" id="ac-gn-menustate" class="ac-gn-menustate"/><nav id="ac-globalnav" class="no-js" role="navigation" aria-label="Global" data-hires="false" data-analytics-region="global nav" lang="en-US" dir="ltr" data-store-locale="us" data-store-api="/[storefront]/shop/bag/status" data-search-locale="en_US" data-search-api="/search-services/suggestions/">
      <div class="ac-gn-content">
        <ul class="ac-gn-header">
          <li class="ac-gn-item ac-gn-menuicon">
            <label class="ac-gn-menuicon-label" for="ac-gn-menustate" aria-hidden="true">
              <span class="ac-gn-menuicon-bread ac-gn-menuicon-bread-top">
                <span class="ac-gn-menuicon-bread-crust ac-gn-menuicon-bread-crust-top"></span>
              </span>
              <span class="ac-gn-menuicon-bread ac-gn-menuicon-bread-bottom">
                <span class="ac-gn-menuicon-bread-crust ac-gn-menuicon-bread-crust-bottom"></span>
              </span>
            </label>
            <a href="#ac-gn-menustate" role="button" class="ac-gn-menuanchor ac-gn-menuanchor-open" id="ac-gn-menuanchor-open">
              <span class="ac-gn-menuanchor-label">Global Nav Open Menu</span>
            </a>
            <a href="#" role="button" class="ac-gn-menuanchor ac-gn-menuanchor-close" id="ac-gn-menuanchor-close">
              <span class="ac-gn-menuanchor-label">Global Nav Close Menu</span>
            </a>
          </li>
          <li class="ac-gn-item ac-gn-apple">
            <a class="ac-gn-link ac-gn-link-apple-developer" href="/" data-analytics-title="appledeveloper home" id="ac-gn-firstfocus-small">
              <span class="ac-gn-link-text">Apple Developer</span>
            </a>
          </li>
        </ul>
        <div class="ac-gn-search-placeholder-container" role="search">
          <div class="ac-gn-search ac-gn-search-small">
            <a id="ac-gn-link-search-small" class="ac-gn-link" href="/search/" data-analytics-title="search" data-analytics-click="search" data-analytics-intrapage-link aria-label="Search Developer">
              </a><div class="ac-gn-search-placeholder-bar">
                <div class="ac-gn-search-placeholder-input">
                  <div class="ac-gn-search-placeholder-input-text" aria-hidden="true">
                    <div class="ac-gn-link-search ac-gn-search-placeholder-input-icon"></div>
                    <span class="ac-gn-search-placeholder">Search Developer</span>
                  </div>
                </div>
                <div class="ac-gn-searchview-close ac-gn-searchview-close-small ac-gn-search-placeholder-searchview-close">
                  <span class="ac-gn-searchview-close-cancel" aria-hidden="true">Cancel</span>
                </div>
              </div>
            </a>
          </div>
        </div>
        <ul class="ac-gn-list">
          <li class="ac-gn-item ac-gn-apple">
            <a class="ac-gn-link ac-gn-link-apple-developer" href="/" data-analytics-title="appledeveloper home" id="ac-gn-firstfocus">
              <span class="ac-gn-link-text">Apple Developer</span>
              </a>
          </li>
          <li class="ac-gn-item ac-gn-item-menu ac-gn-discover">
            <a class="ac-gn-link ac-gn-link-discover" href="/discover/" data-analytics-title="discover">
              <span class="ac-gn-link-text">Discover</span>
              </a>
          </li>
          <li class="ac-gn-item ac-gn-item-menu ac-gn-design">
            <a class="ac-gn-link ac-gn-link-design" href="/design/" data-analytics-title="design">
              <span class="ac-gn-link-text">Design</span>
              </a>
          </li>
          <li class="ac-gn-item ac-gn-item-menu ac-gn-develop">
            <a class="ac-gn-link ac-gn-link-develop" href="/develop/" data-analytics-title="develop">
              <span class="ac-gn-link-text">Develop</span>
              </a>
          </li>
          <li class="ac-gn-item ac-gn-item-menu ac-gn-distribute">
            <a class="ac-gn-link ac-gn-link-distribute" href="/distribute/" data-analytics-title="distribute">
              <span class="ac-gn-link-text">Distribute</span>
              </a>
          </li>
          <li class="ac-gn-item ac-gn-item-menu ac-gn-dsupport">
            <a class="ac-gn-link ac-gn-link-dsupport" href="/support/" data-analytics-title="dsupport">
              <span class="ac-gn-link-text">Support</span>
              </a>
          </li>
          <li class="ac-gn-item ac-gn-item-menu ac-gn-account">
            <a class="ac-gn-link ac-gn-link-account" href="/account/" data-analytics-title="account">
              <span class="ac-gn-link-text">Account</span>
              </a>
          </li>
          <li class="ac-gn-item ac-gn-item-menu ac-gn-search" role="search">
            <a id="ac-gn-link-search" class="ac-gn-link ac-gn-link-search" href="/search/" data-analytics-title="search" data-analytics-click="search" data-analytics-intrapage-link aria-label="Search Developer"></a>
          </li>
        </ul>
        <aside id="ac-gn-searchview" class="ac-gn-searchview" role="search" data-analytics-region="search">
          <div class="ac-gn-searchview-content">
            <div class="ac-gn-searchview-bar">
              <div class="ac-gn-searchview-bar-wrapper">
                <form id="ac-gn-searchform" class="ac-gn-searchform" action="/search/" method="get">
                  <div class="ac-gn-searchform-wrapper">
                    <input id="ac-gn-searchform-input" class="ac-gn-searchform-input" type="text" name="q" aria-label="Search Developer" placeholder="Search Developer" autocorrect="off" autocapitalize="off" autocomplete="off" spellcheck="false" role="combobox" aria-autocomplete="list" aria-expanded="true" aria-owns="quicklinks suggestions" />
                    <button id="ac-gn-searchform-submit" class="ac-gn-searchform-submit" type="submit" disabled aria-label="Submit Search"></button>
                    <button id="ac-gn-searchform-reset" class="ac-gn-searchform-reset" type="reset" disabled aria-label="Clear Search">
                        <span class="ac-gn-searchform-reset-background"></span>
                      </button>
                  </div>
                </form>
                <button id="ac-gn-searchview-close-small" class="ac-gn-searchview-close ac-gn-searchview-close-small" aria-label="Cancel Search">
                    <span class="ac-gn-searchview-close-cancel" aria-hidden="true">
                      Cancel
                    </span>
                  </button>
              </div>
            </div>
            <aside id="ac-gn-searchresults" class="ac-gn-searchresults" data-string-quicklinks="Quick Links" data-string-suggestions="Suggested Searches" data-string-noresults=""></aside>
          </div>
          <button id="ac-gn-searchview-close" class="ac-gn-searchview-close" aria-label="Cancel Search">
              <span class="ac-gn-searchview-close-wrapper">
                <span class="ac-gn-searchview-close-left"></span>
                <span class="ac-gn-searchview-close-right"></span>
              </span>
            </button>
        </aside>
          </div>
    </nav><div class="ac-gn-blur"></div><div id="ac-gn-curtain" class="ac-gn-curtain"></div><div id="ac-gn-placeholder" class="ac-nav-placeholder"></div><input type="checkbox" id="localnav-menustate" class="localnav-menustate" aria-hidden="true"/><nav id="localnav" class="localnav localnav-dark theme-dark localnav-scrim localnav-noborder" role="navigation" aria-label="API Reference" data-sticky="true"><div class="localnav-wrapper"><div class="referencenav"><div class="localnav-background"></div><div class="localnav-content"><a href="../../../../index.html" class="localnav-title">Documentation</a><div class="localnav-menu"><a href="#localnav-menustate" id="localnav-menustate-open" class="localnav-menucta-anchor localnav-menucta-anchor-open"><span class="localnav-menucta-anchor-label" aria-hidden="true">Open Menu</span></a><a href="#" id="localnav-menustate-close" class="localnav-menucta-anchor localnav-menucta-anchor-close"><span class="localnav-menucta-anchor-label" aria-hidden="true">Close Menu</span></a><div class="localnav-menu-tray"><ul aria-label="Breadcrumbs" class="localnav-menu-items localnav-menu-breadcrumbs"><li class="localnav-menu-item localnav-menu-breadcrumb-item truncated"><a class="localnav-menu-link" href="../../../../documentation/foundation_language-objc.html"><span class="enstr">Foundation</span><!--end_enstr-->
<span class="jpstr">
ファウンデーション
</span><!--end_jpstr-->
</a></li><li class="localnav-menu-item localnav-menu-breadcrumb-item truncated"><a class="localnav-menu-link" href="../../../../documentation/foundation/url_loading_system_language-objc.html"><span class="enstr">URL Loading System</span><!--end_enstr-->
<span class="jpstr">
URLローディングシステム
</span><!--end_jpstr-->
</a></li><li class="localnav-menu-item localnav-menu-breadcrumb-item truncated-breadcrumbs"><button class="localnav-menu-breadcrumb-link truncated-breadcrumbs-disclosebtn"><span class="truncated-breadcrumbs-disclosebtn-indicator">⋯</span></button><ul class="truncated-breadcrumbs-dropdown"><li class="truncated-breadcrumbs-dropdown-item"><a class="truncated-breadcrumbs-dropdown-item-link" href="../../../../documentation/foundation_language-objc.html"><span class="enstr">Foundation</span><!--end_enstr-->
<span class="jpstr">
ファウンデーション
</span><!--end_jpstr-->
</a></li><li class="truncated-breadcrumbs-dropdown-item"><a class="truncated-breadcrumbs-dropdown-item-link" href="../../../../documentation/foundation/url_loading_system_language-objc.html"><span class="enstr">URL Loading System</span><!--end_enstr-->
<span class="jpstr">
URLローディングシステム
</span><!--end_jpstr-->
</a></li></ul></li><li class="localnav-menu-item localnav-menu-breadcrumb-item"><a class="localnav-menu-link" href="../../../../documentation/foundation/url_loading_system/handling_an_authentication_challenge_language-objc.html"><span class="enstr">Handling an Authentication Challenge</span><!--end_enstr-->
<span class="jpstr">
認証チャレンジを取り扱う
</span><!--end_jpstr-->
</a></li><li class="localnav-menu-item localnav-menu-breadcrumb-item"><div class="localnav-menu-breadcrumb-current-container localnav-menu-link current"><span aria-current="page" class="localnav-menu-breadcrumb-current"><span class="enstr">Performing Manual Server Trust Authentication</span><!--end_enstr-->
<span class="jpstr">
手動でサーバー信用認証を実行する
</span><!--end_jpstr-->
</span></div></li></ul><ul class="localnav-menu-items localnav-menu-settings" data-breadcrumbs-count="4"><li class="localnav-menu-setting language-container"><div class="language-toggle-container"><label for="language-toggle" class="language-toggle-label">Language:</label><select id="language-toggle" class="language-dropdown localnav-menu-link" style="width:auto"><option value="swift">Swift</option><option selected="" value="occ">Objective-C</option></select></div><div class="language-list-container"><span class="localnav-menu-setting-label">Language:</span><ul class="language-list"><li class="language-list-item"><a href="../../../../documentation/foundation/url_loading_system/handling_an_authentication_challenge/performing_manual_server_trust_authentication.html" class="localnav-menu-setting-link">Swift</a></li><li class="language-list-item"><span data-language="objc" aria-current="page" class="current-language">Objective-C</span></li></ul></div></li><li class="localnav-menu-setting"><span class="localnav-menu-setting-label">API Changes:</span><span class="changes-toggle">None</span></li></ul></div><div class="localnav-actions"><div class="localnav-action localnav-action-menucta" aria-hidden="true"><label for="localnav-menustate" class="localnav-menucta"><span class="localnav-menucta-chevron"></span></label></div></div></div></div></div></div></nav><label for="localnav-menustate" id="localnav-curtain" aria-hidden="true"></label><main role="main" id="main" class="main" tabindex="0"><div class="topic-title"><span class="eyebrow">Article</span><h1 class="topic-heading"><span><span class="enstr">Performing Manual Server Trust Authentication</span><!--end_enstr-->
<span class="jpstr">
手動でサーバー信用認証を実行する
</span><!--end_jpstr-->
</span></h1></div><div class="topic-container section-content row"><div class="topic-description column large-9 medium-9 small-12"><div class="topic-abstract abstract formatted-content"><div><p><span class="enstr">Evaluate the server’s security credentials in your app.</span><!--end_enstr-->
<span class="jpstr">
サーバーのもつ保安資格情報をあなたのアプリにおいて評価します。
</span><!--end_jpstr-->
</p></div></div></div><div class="topic-summary column large-3 medium-3 small-12"><div class="topic-summary-section frameworks" role="complementary" aria-label="Framework"><p class="topic-summary-section-label subsection-label"><span class="enstr">Framework</span><!--end_enstr-->
<span class="jpstr">
フレームワーク
</span><!--end_jpstr-->
</p><ul class="topic-summary-section-list"><li class="topic-summary-section-item"><span><span class="enstr">Foundation</span><!--end_enstr-->
<span class="jpstr">
ファウンデーション
</span><!--end_jpstr-->
</span></li></ul></div></div><div class="topic-content column large-9 medium-9 small-12" id="topic-content"><section id="overview" class="section"><h2><span class="enstr">Overview</span><!--end_enstr-->
<span class="jpstr">
概要
</span><!--end_jpstr-->
</h2><div class="formatted-content"><div><p>When you use a secure connection (such as <code class="code-voice"><span>https</span></code>) with a URL request, your <a class="symbol-name" href="../../../../documentation/foundation/nsurlsessiondelegate_language-objc.html"><code><span>NSURLSession<wbr/>Delegate</span></code></a> receives an authentication challenge with an authentication type of <a class="symbol-name" href="../../../../documentation/foundation/nsurlauthenticationmethodservertrust_language-objc.html"><code><span>NSURLAuthentication<wbr/>Method<wbr/>Server<wbr/>Trust</span></code></a>. <span class="enstr">Unlike other challenges where the server is asking your app to authenticate itself, this is an opportunity for you to authenticate the server’s credentials.</span><!--end_enstr-->
<span class="jpstr">
あなたのアプリそれ自身の正当性の証明をサーバが要求している他のチャレンジとは違い、これはサーバのもつ資格情報を認証するあなたにとっての機会です。
</span><!--end_jpstr-->
</p><aside class="aside aside-tip" aria-label="tip"><p class="aside-name"><span class="enstr">Tip</span><!--end_enstr-->
<span class="jpstr">
秘訣
</span><!--end_jpstr-->
</p><p><span class="enstr">See <a href="../../../../documentation/foundation/url_loading_system/handling_an_authentication_challenge_language-objc.html">Handling an Authentication Challenge</a> for an introduction to authentication challenges.</span><!--end_enstr-->
<span class="jpstr">
<a href="../../../../documentation/foundation/url_loading_system/handling_an_authentication_challenge_language-objc.html">認証チャレンジを取り扱う</a>を認証チャレンジの導入として見てください。
</span><!--end_jpstr-->
</p></aside><p></p></div><h3 id="2959677"><span class="enstr">Determine When Manual Server Trust Evaluation Is Appropriate</span><!--end_enstr-->
<span class="jpstr">
手動サーバ信用評価が適切である場合を決定する
</span><!--end_jpstr-->
</h3><div><p><span class="enstr">In most cases, you should let the URL Loading System’s default handling evaluate the server trust. You get this behavior when you either don’t have a delegate or don’t handle authentication challenges. However, performing your own evaluation may be useful for scenarios like the following:</span><!--end_enstr-->
<span class="jpstr">
多くの場合、あなたはURLローディングシステムのもつ省略時の処理にサーバ信用を評価させるべきです。あなたは、あなたが委任先を持たないまたは認証チャレンジを取り扱わないのどちらかの場合に、この挙動を得ます。しかしながら、あなた独自の評価を実行することは、以下のような事態に役立つかもしれません：
</span><!--end_jpstr-->
</p><ul><li><p><span class="enstr">You want to accept server credentials that would otherwise be rejected by the system. For example, your app makes a secure connection to a development server that uses a self-signed certificate, which would ordinarily not match anything in the system’s trust store.</span><!--end_enstr-->
<span class="jpstr">
あなたは、サーバ資格情報を受け入れることを望みます、それはそうしなければシステムによって拒絶されるだろうものです。例えば、あなたのアプリが安全な接続を、ある開発サーバーへします、それはある自己署名証明書を使います、それは通常はシステムのもつトラストストアの中のどれとも一致しないでしょう。
</span><!--end_jpstr-->
</p></li><li><p><span class="enstr">You want to reject credentials that would otherwise be accepted by the system. For example, you want to “pin” your app to a set of specific keys or certificates under your control, rather than accept any valid credential.</span><!--end_enstr-->
<span class="jpstr">
あなたは資格情報を拒絶することを望みます、それはそうしなければシステムによって受け入れられるだろうものです。例えば、あなたは、あなたのアプリを一揃いの特定のキーまたは証明書と、あなたの制御下で “固定” することを望みます、なんであれ有効な資格情報を受け入れるのではなく。
</span><!--end_jpstr-->
</p></li></ul><p><span class="enstr"><a href="../../../../documentation/foundation/url_loading_system/handling_an_authentication_challenge/performing_manual_server_trust_authentication_language-objc.html#2959678">Figure 1</a> illustrates how an app performs manual credential evaluation by providing a delegate method to handle the authentication challenge. This bypasses the default handling. Instead, the delegate directly compares the server certificate or its public key against a copy of the certificate or key (or a hash of either of these) stored in the app bundle itself. If the delegate decides the server credential is valid, it accepts the server trust and allows the connection to continue.</span><!--end_enstr-->
<span class="jpstr">
<a href="../../../../documentation/foundation/url_loading_system/handling_an_authentication_challenge/performing_manual_server_trust_authentication_language-objc.html#2959678">図 1</a> は、どのようにアプリが手動で資格情報評価を、委任先メソッドを提供することによって実行して、認証チャレンジを取り扱うかを例示します。これは、省略時の処理を迂回します。代わりに、委任先はサーバー証明書またはそれのパブリックキーを、アプリバンドルそれ自身の中に格納される証明書またはキーのコピー（またはそれらのどちらかのハッシュ）に対して直接に比較します。委任先がそのサーバ資格情報が有効であると決定するならば、それはサーバ信用を受け入れて、接続を続けることを許可します。
</span><!--end_jpstr-->
</p><figure id="2959678"><figcaption><strong class="caption-title"><span class="enstr">Figure 1</span><!--end_enstr-->
<span class="jpstr">
図 1
</span><!--end_jpstr-->
</strong> <div class="caption-content formatted-content"><div><p><span class="enstr">Manually evaluating server trust against credentials stored in the app bundle.</span><!--end_enstr-->
<span class="jpstr">
アプリバンドルに格納される資格情報に対してサーバ信用を手動で評価する
</span><!--end_jpstr-->
</p></div></div></figcaption><img class="centered-block" src="../../../../../docs-assets.developer.apple.com/published/2bf837db81/4c0b5097-e452-40f4-9052-354a59d50dd6.png" srcSet="../../../../../docs-assets.developer.apple.com/published/2bf837db81/4c0b5097-e452-40f4-9052-354a59d50dd6.png 1x, https://docs-assets.developer.apple.com/published/6a6496ebb1/851916ce-5c1c-4c23-b45b-c4632dacf24c.png 2x" alt='Flow diagram of a server trust being evaluated manually by a delegate method. A certificate in the server trust matches a certificate inside the app bundle, so the server trust is manually accepted and the flow ends with a "connect" state.' width="918" height="auto"/></figure><p></p><aside class="aside aside-note" role="note"><p class="aside-name"><span class="enstr">Note</span><!--end_enstr-->
<span class="jpstr">
注意
</span><!--end_jpstr-->
</p><p><code class="code-voice"><span>NSURLSession</span></code> enforces <a href="../../../../documentation/foundation/nsurlsession_language-objc.html#1776695">App Transport Security (ATS)</a>, if it is enabled for the domain you are connecting to. <span class="enstr">This applies security requirements for the certificates, TLS version, and cipher used by the connection. You cannot loosen server trust requirements for an ATS-protected domain, but you can tighten them, using the manual evaluation technique shown in this article. See <a href="https://developer.apple.com/library/archive/documentation/General/Reference/InfoPlistKeyReference/Articles/CocoaKeys.html#//apple_ref/doc/plist/info/NSAppTransportSecurity">NSAppTransportSecurity</a> in <a href="https://developer.apple.com/library/archive/documentation/General/Reference/InfoPlistKeyReference/Introduction/Introduction.html#//apple_ref/doc/uid/TP40009247">Information Property List Key Reference</a> for further details.</span><!--end_enstr-->
<span class="jpstr">
これは、保安要件いくらかを、証明書、TLSバージョン、および接続によって使われる暗号に対して適用します。あなたは、サーバ信用要件それらをATS保護ドメインに対して緩和することはできません、しかしあなたはそれらを厳しくはできます、この記事で示される手動評価テクニックを使って。<a href="https://developer.apple.com/library/archive/documentation/General/Reference/InfoPlistKeyReference/Articles/CocoaKeys.html#//apple_ref/doc/plist/info/NSAppTransportSecurity">NSAppTransportSecurity</a>を<a href="https://developer.apple.com/library/archive/documentation/General/Reference/InfoPlistKeyReference/Introduction/Introduction.html#//apple_ref/doc/uid/TP40009247">Information Property List Key Reference</a>においてさらに進んだ詳細として見てください。
</span><!--end_jpstr-->
</p></aside><p></p><p></p><p></p><p></p><p></p></div><h3 id="2948638"><span class="enstr">Handle Server Trust Authentication Challenges</span><!--end_enstr-->
<span class="jpstr">
サーバ信用信用チャレンジを取り扱う
</span><!--end_jpstr-->
</h3><div><p>To perform manual server trust authentication, implement the <code class="code-voice"><span>NSURLSession<wbr/>Delegate</span></code> method <a class="symbol-name" href="../../../../documentation/foundation/nsurlsessiondelegate/1409308-urlsession_language-objc.html"><code><span>URLSession:<wbr/>did<wbr/>Receive<wbr/>Challenge:<wbr/>completion<wbr/>Handler:</span></code></a>. <span class="enstr">When this method is called, the first things your implementation needs to do are to check that:</span><!--end_enstr-->
<span class="jpstr">
このメソッドが呼び出される時、あなたの実装がする必要がある最初の事は、以下を確認することです：
</span><!--end_jpstr-->
</p><ul><li><p><span class="enstr">The challenge type is server trust, and not some other kind of challenge.</span><!--end_enstr-->
<span class="jpstr">
チャレンジ型は、サーバ信用である、そして何らかの他の種類のチャレンジではない。
</span><!--end_jpstr-->
</p></li><li><p><span class="enstr">The challenge’s host name matches the host that you want to perform manual credential evaluation for.</span><!--end_enstr-->
<span class="jpstr">
チャレンジのもつホスト名は、あなたがそれに対して手動の資格情報評価を実行したいホストと一致する。
</span><!--end_jpstr-->
</p></li></ul><p><a href="../../../../documentation/foundation/url_loading_system/handling_an_authentication_challenge/performing_manual_server_trust_authentication_language-objc.html#2956147">Listing 1</a> shows how to test these conditions, given the <code class="code-voice"><span>challenge</span></code> parameter passed to the <code class="code-voice"><span>URLSession:<wbr/>did<wbr/>Receive<wbr/>Challenge:<wbr/>completion<wbr/>Handler:</span></code> callback. <span class="enstr">It gets the challenge's <a class="symbol-name" href="../../../../documentation/foundation/nsurlauthenticationchallenge/1410012-protectionspace_language-objc.html"><code><span>protection<wbr/>Space</span></code></a> and uses it to perform the two checks listed above. First, it gets the <a class="symbol-name" href="../../../../documentation/foundation/nsurlprotectionspace/1415028-authenticationmethod_language-objc.html"><code><span>authentication<wbr/>Method</span></code></a> from the protection space and checks that the type of authentication is <a class="symbol-name" href="../../../../documentation/foundation/nsurlauthenticationmethodservertrust_language-objc.html"><code><span>NSURLAuthentication<wbr/>Method<wbr/>Server<wbr/>Trust</span></code></a>. Then it makes sure the protection space’s <a class="symbol-name" href="../../../../documentation/foundation/nsurlprotectionspace/1418205-host_language-objc.html"><code><span>host</span></code></a> matches the expected name <code class="code-voice"><span>example<wbr/>.com</span></code>.</span><!--end_enstr-->
<span class="jpstr">
それは、チャレンジのもつ<a class="symbol-name" href="../../../../documentation/foundation/nsurlauthenticationchallenge/1410012-protectionspace_language-objc.html"><code><span>protection<wbr/>Space</span></code></a>を取得して、そしてそれを使って上で列記される２つの検査を実行します。最初に、それは<a class="symbol-name" href="../../../../documentation/foundation/nsurlprotectionspace/1415028-authenticationmethod_language-objc.html"><code><span>authentication<wbr/>Method</span></code></a>を保護空間から取得します、そして認証の型が<a class="symbol-name" href="../../../../documentation/foundation/nsurlauthenticationmethodservertrust_language-objc.html"><code><span>NSURLAuthentication<wbr/>Method<wbr/>Server<wbr/>Trust</span></code></a>であることを確認します。それからそれは保護空間のもつ<a class="symbol-name" href="../../../../documentation/foundation/nsurlprotectionspace/1418205-host_language-objc.html"><code><span>host</span></code></a>が期待される名前<code class="code-voice"><span>example<wbr/>.com</span></code>と一致することを確認します。
</span><!--end_jpstr-->
If either of these conditions are not met, it calls the <code class="code-voice"><span>completion<wbr/>Handler</span></code> with the <a class="symbol-name" href="../../../../documentation/foundation/nsurlsessionauthchallengedisposition/nsurlsessionauthchallengeperformdefaulthandling_language-objc.html"><code><span>NSURLSession<wbr/>Auth<wbr/>Challenge<wbr/>Perform<wbr/>Default<wbr/>Handling</span></code></a> disposition to allow the system to handle the challenge.</p><figure id="2956147"><figcaption><strong class="caption-title"><span class="enstr">Listing 1</span><!--end_enstr-->
<span class="jpstr">
コード出力 1
</span><!--end_jpstr-->
</strong> <div class="caption-content formatted-content"><div><p><span class="enstr">Testing the challenge type and host name of a server trust authentication challenge.</span><!--end_enstr-->
<span class="jpstr">
サーバ信用認証チャレンジのチャレンジ型とホスト名を試験する。
</span><!--end_jpstr-->
</p></div></div></figcaption><div class="formatted-content"><div class="code-listing"><pre class="code-source" data-language="swift"><code>let protectionSpace = challenge.protectionSpace
guard protectionSpace.authenticationMethod ==
    NSURLAuthenticationMethodServerTrust,
    protectionSpace.host.contains("example.com") else {
        completionHandler(.performDefaultHandling, nil)
        return
}
</code></pre></div></div></figure><p></p></div><h3 id="2948637"><span class="enstr">Evaluate the Credential in the Challenge</span><!--end_enstr-->
<span class="jpstr">
チャレンジにおいて資格情報を評価する
</span><!--end_jpstr-->
</h3><div><p>To access the server’s credential, get the <a class="symbol-name" href="../../../../documentation/foundation/nsurlprotectionspace/1409926-servertrust_language-objc.html"><code><span>server<wbr/>Trust</span></code></a> property (an instance of the <a class="symbol-name" href="https://developer.apple.com/documentation/security/sectrustref_language-objc"><code><span>Sec<wbr/>Trust<wbr/>Ref</span></code></a> class) from the protection space. <a href="../../../../documentation/foundation/url_loading_system/handling_an_authentication_challenge/performing_manual_server_trust_authentication_language-objc.html#2948636">Listing 2</a> shows how to access the server trust and accept or reject it. The listing starts by attempting to get the <code class="code-voice"><span>server<wbr/>Trust</span></code> property from the protection space, and falls back to default handling if the property is <code class="code-voice"><span>nil</span></code>. Next, it passes the server trust to a private helper method <code class="code-voice"><span>check<wbr/>Validity(of:)</span></code> that compares the certificate or public key in the server trust to known-good values stored in the app bundle. </p><figure id="2948636"><figcaption><strong class="caption-title"><span class="enstr">Listing 2</span><!--end_enstr-->
<span class="jpstr">
コード出力 2 
</span><!--end_jpstr-->
</strong> <div class="caption-content formatted-content"><div><p><span class="enstr">Evaluating credentials in a server trust instance.</span><!--end_enstr-->
<span class="jpstr">
サーバ信用インスタンスの中の資格情報を評価する。
</span><!--end_jpstr-->
</p></div></div></figcaption><div class="formatted-content"><div class="code-listing"><pre class="code-source" data-language="swift"><code>guard let serverTrust = protectionSpace.serverTrust else {
    completionHandler(.performDefaultHandling, nil)
    return
}
if checkValidity(of: serverTrust) {
    let credential = URLCredential(trust: serverTrust)
    completionHandler(.useCredential, credential)
} else {
    // Show a UI here warning the user the server credentials are
    // invalid, and cancel the load.
    completionHandler(.cancelAuthenticationChallenge, nil)
}
</code></pre></div></div></figure><p><span class="enstr">Once the code determines the validity of the server trust, it takes one of two actions:</span><!--end_enstr-->
<span class="jpstr">
一旦コードがサーバ信用の正当性を決定するならば、それは２つの動作のうち１つを取ります：
</span><!--end_jpstr-->
</p><ul><li><p>If the server trust’s credential is valid, create a new <a class="symbol-name" href="../../../../documentation/foundation/nsurlcredential_language-objc.html"><code><span>NSURLCredential</span></code></a> instance from the server trust. Then call the <code class="code-voice"><span>completion<wbr/>Handler</span></code> with the <a class="symbol-name" href="../../../../documentation/foundation/nsurlsessionauthchallengedisposition/nsurlsessionauthchallengeusecredential_language-objc.html"><code><span>NSURLSession<wbr/>Auth<wbr/>Challenge<wbr/>Use<wbr/>Credential</span></code></a> disposition, passing in the newly-created credential. <span class="enstr">This tells the system to accept the server’s credentials.</span><!--end_enstr-->
<span class="jpstr">
これは、システムにサーバのもつ資格情報を受け入れるように伝えます。
</span><!--end_jpstr-->
</p></li><li><p>If the challenge’s credential is invalid, call the <code class="code-voice"><span>completion<wbr/>Handler</span></code> with the <a class="symbol-name" href="../../../../documentation/foundation/nsurlsessionauthchallengedisposition/nsurlsessionauthchallengecancelauthenticationchallenge_language-objc.html"><code><span>NSURLSession<wbr/>Auth<wbr/>Challenge<wbr/>Cancel<wbr/>Authentication<wbr/>Challenge</span></code></a> disposition. <span class="enstr">This tells the system to reject the server’s credentials.</span><!--end_enstr-->
<span class="jpstr">
これは、システムにサーバーのもつ資格情報を拒否するように伝えます。
</span><!--end_jpstr-->
</p></li></ul><aside class="aside aside-tip" aria-label="tip"><p class="aside-name"><span class="enstr">Tip</span><!--end_enstr-->
<span class="jpstr">
秘訣
</span><!--end_jpstr-->
</p><p>See <a href="https://developer.apple.com/documentation/security/certificate_key_and_trust_services_language-objc">Certificate, Key, and Trust Services</a> to learn more about how to evaluate a <code class="code-voice"><span>Sec<wbr/>Trust<wbr/>Ref</span></code> instance or access certificates or public keys from it.</p></aside><p></p></div><h3 id="2956135"><span class="enstr">Create a Long-Term Server Authentication Strategy</span><!--end_enstr-->
<span class="jpstr">
長期のサーバ認証計画を作成する
</span><!--end_jpstr-->
</h3><div><p><span class="enstr">If you determine that you need to evaluate server trust manually in some or all cases,  plan for what your app will do if you need to change your server credentials. Keep the following guidelines in mind:</span><!--end_enstr-->
<span class="jpstr">
あなたがサーバ信用を幾つかのまたは全ての場合に手動で評価する必要があると決定するならば、あなたがあなたのサーバ資格情報を変更する必要があったならあなたのアプリがどうするかについて計画してください。以下の指針に従うことを覚えておいてください：
</span><!--end_jpstr-->
</p><ul><li><p><span class="enstr">Compare the server’s credentials against a public key, instead of storing a single certificate in your app bundle. This will allow you to reissue a certificate for the same key and update the server, rather than needing to update the app.</span><!--end_enstr-->
<span class="jpstr">
サーバーのもつ資格情報をある公開鍵（パブリックキー）に対して比較してください、ある単一の証明書をあなたのアプリのバンドルの中に格納しておく代わりに。これは、あなたにある証明書を同じ鍵に対して再発行させてサーバを更新させます、アプリの更新を必要とする代わりに。
</span><!--end_jpstr-->
</p></li><li><p><span class="enstr">Compare the issuing certificate authority’s (CA’s) keys, rather than using the leaf key. This way, you can deploy certificates containing new keys signed by the same CA.</span><!--end_enstr-->
<span class="jpstr">
発行している認証局（CA）の鍵を比較してください、葉っぱ鍵ではなく。そうして、あなたは同じCAによって署名される新しい鍵を含んでいる証明書を配備できます。
</span><!--end_jpstr-->
</p></li><li><p><span class="enstr">Use a set of keys or CAs, so you can rotate server credentials more gracefully.</span><!--end_enstr-->
<span class="jpstr">
一揃いの鍵またはCAを使ってください、それであなたはサーバ資格情報をより優雅に切り替えられます。
</span><!--end_jpstr-->
</p></li></ul><p></p><p></p></div></div></section></div></div></main><section id="globalfooter-wrapper"><footer id="globalfooter" role="contentinfo">
        <nav class="footer-breadory">
          <a href="/" class="home breadcrumbs-home"><span aria-hidden="true"></span><span class="breadcrumbs-home-label">Developer</span></a>
          <section class="breadcrumbs">
            <ol class="breadcrumbs-list">
              <li><a href=/documentation>Documentation</a></li>
            </ol>
          </section>
          <div id="directorynav" class="directorynav">
            <div id="dn-cola" class="column">
              <h3><a href="/discover/">Discover</a></h3>
              <ul>
                <li><a href="/macos/">macOS</a></li>
                <li><a href="/ios/">iOS</a></li>
                <li><a href="/watchos/">watchOS</a></li>
                <li><a href="/tvos/">tvOS</a></li>
                <li><a href="/safari/">Safari and Web</a></li>
                <li><a href="/games/">Games</a></li>
                <li><a href="/business/">Business</a></li>
                <li><a href="/education/">Education</a></li>
                <li><a href="/wwdc/">WWDC</a></li>
              </ul>
            </div>
            <div id="dn-colb" class="column">
              <h3><a href="/design/">Design</a></h3>
              <ul>
                <li><a href="/design/human-interface-guidelines/">Human Interface Guidelines</a></li>
                <li><a href="/design/resources/"><span class="enstr">Resources</span><!--end_enstr-->
<span class="jpstr">
リソース
</span><!--end_jpstr-->
</a></li>
                <li><a href="/videos/design/">Videos</a></li>
                <li><a href="/design/awards/">Apple Design Awards</a></li>
                <li><a href="/accessibility/">Accessibility</a></li>
                <li><a href="/internationalization/"><span class="enstr">Internationalization</span><!--end_enstr-->
<span class="jpstr">
国際化
</span><!--end_jpstr-->
</a></li>
                <li><a href="/accessories/">Accessories</a></li>
              </ul>
            </div>
            <div id="dn-colc" class="column">
              <h3><a href="/develop/">Develop</a></h3>
              <ul>
                <li><a href="/xcode/">Xcode</a></li>
                <li><a href="/swift/">Swift</a></li>
                <li><a href="/swift-playgrounds/">Swift Playgrounds</a></li>
                <li><a href="/testflight/">TestFlight</a></li>
                <li><a href="https://developer.apple.com/documentation/">Documentation</a></li>
                <li><a href="/videos/">Videos</a></li>
                <li><a href="/download/">Downloads</a></li>
              </ul>
            </div>
            <div id="dn-cold" class="column">
              <h3><a href="/distribute/">Distribute</a></h3>
              <ul>
                <li><a href="/programs/">Developer Program</a></li>
                <li><a href="/app-store/">App Store</a></li>
                <li><a href="/app-store/review/">App Review</a></li>
                <li><a href="/macos/distribution/">Mac Software</a></li>
                <li><a href="/business/distribute/">Apps for Business</a></li>
                <li><a href="/safari/extensions/">Safari Extensions</a></li>
                <li><a href="/app-store/marketing/guidelines/">Marketing Resources</a></li>
                <li><a href="/softwarelicensing/">Trademark Licensing</a></li>
              </ul>
            </div>
            <div id="dn-cole" class="column">
              <h3><a href="/support/">Support</a></h3>
              <ul>
                <li><a href="https://forums.developer.apple.com">Developer Forums</a></li>
                <li><a href="/bug-reporting/">Bug Reporting</a></li>
                <li><a href="/terms/">License Agreements</a></li>
                <li><a href="/system-status/">System Status</a></li>
                <li><a href="/contact/">Contact Us</a></li>
              </ul>
              <h3><a href="/account/">Account</a></h3>
              <ul>
                <li><a href="/account/ios/certificate/">Certificates, IDs &amp; Profiles</a></li>
                <li><a href="https://appstoreconnect.apple.com/">App Store Connect</a></li>
              </ul>
            </div>
          </div>
        </nav>
        <div class="ac-gf-footer-legal">
          <div class="ac-gf-footer-news"> To receive the latest developer news, visit and subscribe to our <a href="/news/">News and Updates</a>.
          </div>
          <div class="ac-gf-footer-legal-copyright">Copyright © 2020 Apple Inc. All rights reserved.</div>
          <div class="ac-gf-footer-legal-links">
            <a href="https://www.apple.com/legal/internet-services/terms/site.html" class="first">Terms of Use</a>
            <a href="https://www.apple.com/privacy/privacy-policy/">Privacy Policy</a>
            <a href="/bug-reporting/">Report Bugs</a>
            <a href="/contact/submit/?subject=website-feedback">Feedback</a>
          </div>
          <div class="ac-gf-footer-language-links">
            <a href="/cn/" class="first">简体中文</a>
            <a href="/jp/">日本語</a>
            <a href="/kr/">한국어</a>
          </div>
        </div>
      </footer></section></div></div><script id="bootstrap-data" type="application/json">{"id":2938915,"abstract":"<div><p>Evaluate the server’s security credentials in your app.<\/p><\/div>","title":{"content":"Performing Manual Server Trust Authentication"},"discussion":"<div><p>When you use a secure connection (such as <code class=\"code-voice\"><span>https<\/span><\/code>) with a URL request, your <a class=\"symbol-name\" href=\"\/documentation\/foundation\/nsurlsessiondelegate_language-objc\"><code><span>NSURLSession<wbr\/>Delegate<\/span><\/code><\/a> receives an authentication challenge with an authentication type of <a class=\"symbol-name\" href=\"\/documentation\/foundation\/nsurlauthenticationmethodservertrust_language-objc\"><code><span>NSURLAuthentication<wbr\/>Method<wbr\/>Server<wbr\/>Trust<\/span><\/code><\/a>. Unlike other challenges where the server is asking your app to authenticate itself, this is an opportunity for you to authenticate the server’s credentials.<\/p><aside class=\"aside aside-tip\" aria-label=\"tip\"><p class=\"aside-name\">Tip<\/p><p>See <a href=\"\/documentation\/foundation\/url_loading_system\/handling_an_authentication_challenge_language-objc\">Handling an Authentication Challenge<\/a> for an introduction to authentication challenges.<\/p><\/aside><p><\/p><\/div><h3 id=\"2959677\">Determine When Manual Server Trust Evaluation Is Appropriate<\/h3><div><p>In most cases, you should let the URL Loading System’s default handling evaluate the server trust. You get this behavior when you either don’t have a delegate or don’t handle authentication challenges. However, performing your own evaluation may be useful for scenarios like the following:<\/p><ul><li><p>You want to accept server credentials that would otherwise be rejected by the system. For example, your app makes a secure connection to a development server that uses a self-signed certificate, which would ordinarily not match anything in the system’s trust store.<\/p><\/li><li><p>You want to reject credentials that would otherwise be accepted by the system. For example, you want to “pin” your app to a set of specific keys or certificates under your control, rather than accept any valid credential.<\/p><\/li><\/ul><p><a href=\"\/documentation\/foundation\/url_loading_system\/handling_an_authentication_challenge\/performing_manual_server_trust_authentication_language-objc#2959678\">Figure 1<\/a> illustrates how an app performs manual credential evaluation by providing a delegate method to handle the authentication challenge. This bypasses the default handling. Instead, the delegate directly compares the server certificate or its public key against a copy of the certificate or key (or a hash of either of these) stored in the app bundle itself. If the delegate decides the server credential is valid, it accepts the server trust and allows the connection to continue.<\/p><figure id=\"2959678\"><figcaption><strong class=\"caption-title\">Figure 1<\/strong> <div class=\"caption-content formatted-content\"><div><p>Manually evaluating server trust against credentials stored in the app bundle.<\/p><\/div><\/div><\/figcaption><img class=\"centered-block\" src=\"https:\/\/docs-assets.developer.apple.com\/published\/2bf837db81\/4c0b5097-e452-40f4-9052-354a59d50dd6.png\" srcSet=\"https:\/\/docs-assets.developer.apple.com\/published\/2bf837db81\/4c0b5097-e452-40f4-9052-354a59d50dd6.png 1x, https:\/\/docs-assets.developer.apple.com\/published\/6a6496ebb1\/851916ce-5c1c-4c23-b45b-c4632dacf24c.png 2x\" alt=\"Flow diagram of a server trust being evaluated manually by a delegate method. A certificate in the server trust matches a certificate inside the app bundle, so the server trust is manually accepted and the flow ends with a &quot;connect&quot; state.\" width=\"918\" height=\"auto\"\/><\/figure><p><\/p><aside class=\"aside aside-note\" role=\"note\"><p class=\"aside-name\">Note<\/p><p><code class=\"code-voice\"><span>NSURLSession<\/span><\/code> enforces <a href=\"\/documentation\/foundation\/nsurlsession_language-objc#1776695\">App Transport Security (ATS)<\/a>, if it is enabled for the domain you are connecting to. This applies security requirements for the certificates, TLS version, and cipher used by the connection. You cannot loosen server trust requirements for an ATS-protected domain, but you can tighten them, using the manual evaluation technique shown in this article. See <a href=\"https:\/\/developer.apple.com\/library\/archive\/documentation\/General\/Reference\/InfoPlistKeyReference\/Articles\/CocoaKeys.html#\/\/apple_ref\/doc\/plist\/info\/NSAppTransportSecurity\">NSAppTransportSecurity<\/a> in <a href=\"https:\/\/developer.apple.com\/library\/archive\/documentation\/General\/Reference\/InfoPlistKeyReference\/Introduction\/Introduction.html#\/\/apple_ref\/doc\/uid\/TP40009247\">Information Property List Key Reference<\/a> for further details.<\/p><\/aside><p><\/p><p><\/p><p><\/p><p><\/p><p><\/p><\/div><h3 id=\"2948638\">Handle Server Trust Authentication Challenges<\/h3><div><p>To perform manual server trust authentication, implement the <code class=\"code-voice\"><span>NSURLSession<wbr\/>Delegate<\/span><\/code> method <a class=\"symbol-name\" href=\"\/documentation\/foundation\/nsurlsessiondelegate\/1409308-urlsession_language-objc\"><code><span>URLSession:<wbr\/>did<wbr\/>Receive<wbr\/>Challenge:<wbr\/>completion<wbr\/>Handler:<\/span><\/code><\/a>. When this method is called, the first things your implementation needs to do are to check that:<\/p><ul><li><p>The challenge type is server trust, and not some other kind of challenge.<\/p><\/li><li><p>The challenge’s host name matches the host that you want to perform manual credential evaluation for.<\/p><\/li><\/ul><p><a href=\"\/documentation\/foundation\/url_loading_system\/handling_an_authentication_challenge\/performing_manual_server_trust_authentication_language-objc#2956147\">Listing 1<\/a> shows how to test these conditions, given the <code class=\"code-voice\"><span>challenge<\/span><\/code> parameter passed to the <code class=\"code-voice\"><span>URLSession:<wbr\/>did<wbr\/>Receive<wbr\/>Challenge:<wbr\/>completion<wbr\/>Handler:<\/span><\/code> callback. It gets the challenge&#x27;s <a class=\"symbol-name\" href=\"\/documentation\/foundation\/nsurlauthenticationchallenge\/1410012-protectionspace_language-objc\"><code><span>protection<wbr\/>Space<\/span><\/code><\/a> and uses it to perform the two checks listed above. First, it gets the <a class=\"symbol-name\" href=\"\/documentation\/foundation\/nsurlprotectionspace\/1415028-authenticationmethod_language-objc\"><code><span>authentication<wbr\/>Method<\/span><\/code><\/a> from the protection space and checks that the type of authentication is <a class=\"symbol-name\" href=\"\/documentation\/foundation\/nsurlauthenticationmethodservertrust_language-objc\"><code><span>NSURLAuthentication<wbr\/>Method<wbr\/>Server<wbr\/>Trust<\/span><\/code><\/a>. Then it makes sure the protection space’s <a class=\"symbol-name\" href=\"\/documentation\/foundation\/nsurlprotectionspace\/1418205-host_language-objc\"><code><span>host<\/span><\/code><\/a> matches the expected name <code class=\"code-voice\"><span>example<wbr\/>.com<\/span><\/code>. If either of these conditions are not met, it calls the <code class=\"code-voice\"><span>completion<wbr\/>Handler<\/span><\/code> with the <a class=\"symbol-name\" href=\"\/documentation\/foundation\/nsurlsessionauthchallengedisposition\/nsurlsessionauthchallengeperformdefaulthandling_language-objc\"><code><span>NSURLSession<wbr\/>Auth<wbr\/>Challenge<wbr\/>Perform<wbr\/>Default<wbr\/>Handling<\/span><\/code><\/a> disposition to allow the system to handle the challenge.<\/p><figure id=\"2956147\"><figcaption><strong class=\"caption-title\">Listing 1<\/strong> <div class=\"caption-content formatted-content\"><div><p>Testing the challenge type and host name of a server trust authentication challenge.<\/p><\/div><\/div><\/figcaption><div class=\"formatted-content\"><div class=\"code-listing\"><pre class=\"code-source\" data-language=\"swift\"><code>let protectionSpace = challenge.protectionSpace\nguard protectionSpace.authenticationMethod ==\n    NSURLAuthenticationMethodServerTrust,\n    protectionSpace.host.contains(&quot;example.com&quot;) else {\n        completionHandler(.performDefaultHandling, nil)\n        return\n}\n<\/code><\/pre><\/div><\/div><\/figure><p><\/p><\/div><h3 id=\"2948637\">Evaluate the Credential in the Challenge<\/h3><div><p>To access the server’s credential, get the <a class=\"symbol-name\" href=\"\/documentation\/foundation\/nsurlprotectionspace\/1409926-servertrust_language-objc\"><code><span>server<wbr\/>Trust<\/span><\/code><\/a> property (an instance of the <a class=\"symbol-name\" href=\"\/documentation\/security\/sectrustref_language-objc\"><code><span>Sec<wbr\/>Trust<wbr\/>Ref<\/span><\/code><\/a> class) from the protection space. <a href=\"\/documentation\/foundation\/url_loading_system\/handling_an_authentication_challenge\/performing_manual_server_trust_authentication_language-objc#2948636\">Listing 2<\/a> shows how to access the server trust and accept or reject it. The listing starts by attempting to get the <code class=\"code-voice\"><span>server<wbr\/>Trust<\/span><\/code> property from the protection space, and falls back to default handling if the property is <code class=\"code-voice\"><span>nil<\/span><\/code>. Next, it passes the server trust to a private helper method <code class=\"code-voice\"><span>check<wbr\/>Validity(of:)<\/span><\/code> that compares the certificate or public key in the server trust to known-good values stored in the app bundle. <\/p><figure id=\"2948636\"><figcaption><strong class=\"caption-title\">Listing 2<\/strong> <div class=\"caption-content formatted-content\"><div><p>Evaluating credentials in a server trust instance.<\/p><\/div><\/div><\/figcaption><div class=\"formatted-content\"><div class=\"code-listing\"><pre class=\"code-source\" data-language=\"swift\"><code>guard let serverTrust = protectionSpace.serverTrust else {\n    completionHandler(.performDefaultHandling, nil)\n    return\n}\nif checkValidity(of: serverTrust) {\n    let credential = URLCredential(trust: serverTrust)\n    completionHandler(.useCredential, credential)\n} else {\n    \/\/ Show a UI here warning the user the server credentials are\n    \/\/ invalid, and cancel the load.\n    completionHandler(.cancelAuthenticationChallenge, nil)\n}\n<\/code><\/pre><\/div><\/div><\/figure><p>Once the code determines the validity of the server trust, it takes one of two actions:<\/p><ul><li><p>If the server trust’s credential is valid, create a new <a class=\"symbol-name\" href=\"\/documentation\/foundation\/nsurlcredential_language-objc\"><code><span>NSURLCredential<\/span><\/code><\/a> instance from the server trust. Then call the <code class=\"code-voice\"><span>completion<wbr\/>Handler<\/span><\/code> with the <a class=\"symbol-name\" href=\"\/documentation\/foundation\/nsurlsessionauthchallengedisposition\/nsurlsessionauthchallengeusecredential_language-objc\"><code><span>NSURLSession<wbr\/>Auth<wbr\/>Challenge<wbr\/>Use<wbr\/>Credential<\/span><\/code><\/a> disposition, passing in the newly-created credential. This tells the system to accept the server’s credentials.<\/p><\/li><li><p>If the challenge’s credential is invalid, call the <code class=\"code-voice\"><span>completion<wbr\/>Handler<\/span><\/code> with the <a class=\"symbol-name\" href=\"\/documentation\/foundation\/nsurlsessionauthchallengedisposition\/nsurlsessionauthchallengecancelauthenticationchallenge_language-objc\"><code><span>NSURLSession<wbr\/>Auth<wbr\/>Challenge<wbr\/>Cancel<wbr\/>Authentication<wbr\/>Challenge<\/span><\/code><\/a> disposition. This tells the system to reject the server’s credentials.<\/p><\/li><\/ul><aside class=\"aside aside-tip\" aria-label=\"tip\"><p class=\"aside-name\">Tip<\/p><p>See <a href=\"\/documentation\/security\/certificate_key_and_trust_services_language-objc\">Certificate, Key, and Trust Services<\/a> to learn more about how to evaluate a <code class=\"code-voice\"><span>Sec<wbr\/>Trust<wbr\/>Ref<\/span><\/code> instance or access certificates or public keys from it.<\/p><\/aside><p><\/p><\/div><h3 id=\"2956135\">Create a Long-Term Server Authentication Strategy<\/h3><div><p>If you determine that you need to evaluate server trust manually in some or all cases,  plan for what your app will do if you need to change your server credentials. Keep the following guidelines in mind:<\/p><ul><li><p>Compare the server’s credentials against a public key, instead of storing a single certificate in your app bundle. This will allow you to reissue a certificate for the same key and update the server, rather than needing to update the app.<\/p><\/li><li><p>Compare the issuing certificate authority’s (CA’s) keys, rather than using the leaf key. This way, you can deploy certificates containing new keys signed by the same CA.<\/p><\/li><li><p>Use a set of keys or CAs, so you can rotate server credentials more gracefully.<\/p><\/li><\/ul><p><\/p><p><\/p><\/div>","containingGroup":[{"id":2938913,"role":"task","paths":[],"symbols":[{"id":2938915,"role":"article","paths":["documentation\/foundation\/url_loading_system\/handling_an_authentication_challenge\/performing_manual_server_trust_authentication"],"abstract":"<div><p>Evaluate the server’s security credentials in your app.<\/p><\/div>","title":{"content":"Performing Manual Server Trust Authentication"}}],"title":{"content":"Creating URL Credentials"}}],"modules":[{"title":{"content":"Foundation"},"paths":["documentation\/foundation"],"importStatement":"<import xml:space=\"preserve\"><keyWord>@import<\/keyWord> Foundation<\/import>","availability":[{"platform":"iOS","introduced":"2.0"},{"platform":"tvOS","introduced":"9.0"},{"platform":"watchOS","introduced":"2.0"},{"platform":"Mac Catalyst","introduced":"13.0"},{"platform":"macOS","introduced":"10.0"}]}],"role":"article","language":"occ","roleHeading":"Article","languages":["occ","swift"],"variants":{"occ":{"paths":["documentation\/foundation\/url_loading_system\/handling_an_authentication_challenge\/performing_manual_server_trust_authentication"]},"swift":{"paths":["documentation\/foundation\/url_loading_system\/handling_an_authentication_challenge\/performing_manual_server_trust_authentication"]}},"pid":492525,"paths":["documentation\/foundation\/url_loading_system\/handling_an_authentication_challenge\/performing_manual_server_trust_authentication"],"hierarchy":[[{"id":1613013,"role":"collection","title":{"content":"Foundation"},"paths":["documentation\/foundation"]},{"id":2877756,"role":"collectionGroup","title":{"content":"URL Loading System"},"paths":["documentation\/foundation\/url_loading_system"]},{"id":2938910,"role":"article","title":{"content":"Handling an Authentication Challenge"},"paths":["documentation\/foundation\/url_loading_system\/handling_an_authentication_challenge"]}]],"legalNotices":{"copyright":"Copyright &copy; 2020 Apple Inc. All rights reserved.","termsOfUse":"https:\/\/www.apple.com\/legal\/internet-services\/terms\/site.html","privacyPolicy":"https:\/\/www.apple.com\/privacy\/privacy-policy"}}</script></body></html>